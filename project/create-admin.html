<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Táº¡o TÃ i Khoáº£n Admin</title>
  <link rel="stylesheet" href="assets/libs/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/dark-mode.css">
</head>
<body class="bg-light">
  <div id="header-placeholder"></div>

  <main class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <h2 class="mb-4">ğŸ” Táº¡o TÃ i Khoáº£n Admin</h2>
            <p class="text-muted mb-4">Äiá»n thÃ´ng tin bÃªn dÆ°á»›i Ä‘á»ƒ táº¡o tÃ i khoáº£n admin. Sau Ä‘Ã³ báº¡n cÃ³ thá»ƒ Ä‘Äƒng nháº­p vÃ  vÃ o Admin Panel.</p>
            
            <form id="create-admin-form">
              <div class="mb-3">
                <label class="form-label">TÃªn</label>
                <input type="text" class="form-control" id="admin-name" value="Admin User" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Email <span class="text-danger">*</span></label>
                <input type="email" class="form-control" id="admin-email" value="admin@travel.com" required>
                <small class="text-muted">Email pháº£i chá»©a tá»« "admin" hoáº·c báº¡n sáº½ chá»n role="admin"</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Máº­t kháº©u</label>
                <input type="password" class="form-control" id="admin-password" value="123456" required>
                <small class="text-muted">Tá»‘i thiá»ƒu 6 kÃ½ tá»±</small>
              </div>
              <div class="mb-3">
                <label class="form-label">XÃ¡c nháº­n máº­t kháº©u</label>
                <input type="password" class="form-control" id="admin-confirm" value="123456" required>
              </div>
              
              <div class="alert alert-info">
                <strong>LÆ°u Ã½:</strong> Sau khi táº¡o thÃ nh cÃ´ng, báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n trang Ä‘Äƒng nháº­p. 
                ÄÄƒng nháº­p vá»›i email vÃ  máº­t kháº©u vá»«a táº¡o Ä‘á»ƒ vÃ o Admin Panel.
              </div>

              <button type="submit" class="btn btn-primary w-100" id="btn-create">
                <span id="btn-text">Táº¡o TÃ i Khoáº£n Admin</span>
                <span id="btn-loading" class="spinner-border spinner-border-sm d-none" role="status"></span>
              </button>
            </form>

            <div class="mt-4 text-center">
              <a href="login.html">ÄÃ£ cÃ³ tÃ i khoáº£n? ÄÄƒng nháº­p</a> | 
              <a href="admin-setup.html">Xem hÆ°á»›ng dáº«n khÃ¡c</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script src="assets/libs/jquery.min.js"></script>
  <script src="assets/libs/bootstrap.bundle.min.js"></script>
  <script src="assets/js/config.js"></script>
  <script src="assets/js/utils.js"></script>
  <script src="assets/js/settings.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    $(function() {
      const { API } = window.APP_CONFIG;
      const { http, showToast } = window.APP_UTILS;

      $("#create-admin-form").on("submit", async function(e) {
        e.preventDefault();
        
        const name = $("#admin-name").val().trim();
        const email = $("#admin-email").val().trim();
        const password = $("#admin-password").val().trim();
        const confirm = $("#admin-confirm").val().trim();

        // Validation
        if (!name || !email || !password || !confirm) {
          showToast("Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin", "warning");
          return;
        }

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          showToast("Email khÃ´ng há»£p lá»‡", "warning");
          return;
        }

        if (password.length < 6) {
          showToast("Máº­t kháº©u tá»‘i thiá»ƒu 6 kÃ½ tá»±", "warning");
          return;
        }

        if (password !== confirm) {
          showToast("Máº­t kháº©u nháº­p láº¡i khÃ´ng khá»›p", "warning");
          return;
        }

        // Check if email exists
        try {
          $("#btn-create").prop("disabled", true);
          $("#btn-text").addClass("d-none");
          $("#btn-loading").removeClass("d-none");

          const exists = await http.get(`${API.users}?email=${encodeURIComponent(email)}`);
          if (Array.isArray(exists) && exists.length > 0) {
            showToast("Email Ä‘Ã£ tá»“n táº¡i. Vui lÃ²ng dÃ¹ng email khÃ¡c hoáº·c Ä‘Äƒng nháº­p.", "warning");
            $("#btn-create").prop("disabled", false);
            $("#btn-text").removeClass("d-none");
            $("#btn-loading").addClass("d-none");
            return;
          }

          // Create admin user
          const user = await http.post(API.users, {
            name,
            email,
            password,
            role: "admin", // Set role as admin
            createdAt: new Date().toISOString(),
          });

          showToast("Táº¡o tÃ i khoáº£n admin thÃ nh cÃ´ng! Äang chuyá»ƒn Ä‘áº¿n trang Ä‘Äƒng nháº­p...", "success");
          
          setTimeout(() => {
            window.location.href = `login.html?email=${encodeURIComponent(email)}`;
          }, 2000);

        } catch (err) {
          showToast("Lá»—i: " + (err.message || "KhÃ´ng thá»ƒ táº¡o tÃ i khoáº£n"), "danger");
          $("#btn-create").prop("disabled", false);
          $("#btn-text").removeClass("d-none");
          $("#btn-loading").addClass("d-none");
        }
      });
    });
  </script>
</body>
</html>


